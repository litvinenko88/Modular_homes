"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[869],{8869:function(e,t,o){o.r(t),o.d(t,{default:function(){return l}});var i=o(5893),n=o(645),a=o.n(n),s=o(7294),r=o(9477);function l(e){let{elements:t,walls:o,doors:n,windows:l,initialData:d,onClose:c}=e,w=(0,s.useRef)(null),h=(0,s.useRef)(null),p=(0,s.useRef)(null),x=(0,s.useRef)(null),m=(0,s.useRef)(null),[f,b]=(0,s.useState)(!0);(0,s.useEffect)(()=>{if(!w.current)return;let e=new r.xsS;e.background=new r.Ilk(8900331),h.current=e;let o=new r.cPb(75,w.current.clientWidth/w.current.clientHeight,.1,1e3);x.current=o;let i=new r.CP7({antialias:!0});i.setSize(w.current.clientWidth,w.current.clientHeight),i.shadowMap.enabled=!0,i.shadowMap.type=r.ntZ,p.current=i,w.current.appendChild(i.domElement);let n=new r.Mig(4210752,.4);e.add(n);let a=new r.Ox3(16777215,1);a.position.set(50,80,30),a.castShadow=!0,a.shadow.mapSize.width=4096,a.shadow.mapSize.height=4096,a.shadow.camera.near=.5,a.shadow.camera.far=500,a.shadow.camera.left=-100,a.shadow.camera.right=100,a.shadow.camera.top=100,a.shadow.camera.bottom=-100,e.add(a);let s=new r.Ox3(8900331,.3);s.position.set(-30,40,-30),e.add(s);let l=new r._12(300,300),d=new r.YBo({color:2263842,transparent:!0,opacity:.8}),c=new r.Kj0(l,d);c.rotation.x=-Math.PI/2,c.receiveShadow=!0,e.add(c);let f=new r._12(3,20),g=new r.YBo({color:6908265}),y=new r.Kj0(f,g);y.rotation.x=-Math.PI/2,y.position.set(0,.01,25),y.receiveShadow=!0,e.add(y),D(e),u(e);let v=t.find(e=>"house"===e.type);if(v){let e=1.5*Math.max(10*v.realWidth,10*v.realHeight);o.position.set(e,.8*e,e),o.lookAt(0,0,0)}let k=!1,j=0,z=0,M=0,S=0,E=0,I=0,K=e=>{k=!0,j=e.clientX,z=e.clientY},J=()=>{k=!1},R=e=>{if(!k)return;let t=e.clientX-j,o=e.clientY-z;S+=.01*t,M+=.01*o,M=Math.max(-Math.PI/3,Math.min(Math.PI/3,M)),j=e.clientX,z=e.clientY},W=e=>{e.preventDefault();let t=e.deltaY>0?1.1:.9;o.position.multiplyScalar(t)};i.domElement.addEventListener("mousedown",K),i.domElement.addEventListener("mouseup",J),i.domElement.addEventListener("mousemove",R),i.domElement.addEventListener("wheel",W);let P=()=>{m.current=requestAnimationFrame(P),E+=(M-E)*.1,I+=(S-I)*.1;let t=o.position.length();o.position.x=t*Math.sin(I)*Math.cos(E),o.position.y=t*Math.sin(E),o.position.z=t*Math.cos(I)*Math.cos(E),o.lookAt(0,0,0),i.render(e,o)};P(),b(!1);let N=()=>{w.current&&(o.aspect=w.current.clientWidth/w.current.clientHeight,o.updateProjectionMatrix(),i.setSize(w.current.clientWidth,w.current.clientHeight))};return window.addEventListener("resize",N),()=>{window.removeEventListener("resize",N),i.domElement.removeEventListener("mousedown",K),i.domElement.removeEventListener("mouseup",J),i.domElement.removeEventListener("mousemove",R),i.domElement.removeEventListener("wheel",W),m.current&&cancelAnimationFrame(m.current),w.current&&i.domElement&&w.current.removeChild(i.domElement),i.dispose()}},[t,o,n,l]);let u=e=>{let o=t.find(e=>"house"===e.type);if(!o)return;let i=new r.ZAu,n=new r.xoR({color:16119260,shininess:10,specular:1118481});new r.xoR({color:9109504,shininess:30,specular:2236962});let a=new r.xoR({color:14596231,shininess:5}),s=new r.xoR({color:6636321,shininess:20,specular:3355443}),l=new r.xoR({color:8900331,transparent:!0,opacity:.6,shininess:100,specular:16777215}),d=new r.xoR({color:16777215,shininess:10}),c=10*o.realWidth,w=10*o.realHeight,h=new r.DvJ(c,2,w),p=new r.Kj0(h,a);p.position.y=1,p.castShadow=!0,p.receiveShadow=!0,i.add(p),g(i,c,w,30,2,n),y(i,30,2,n,10),k(i,30,s,10),j(i,30,l,d,10),z(i,c,w,30,10),e.add(i)},g=(e,t,o,i,a,s)=>{console.log("Creating exterior walls with doors:",n.map(e=>({id:e.id,wallId:e.wallId,position:e.position}))),console.log("Creating exterior walls with windows:",l.map(e=>({id:e.id,wallId:e.wallId,position:e.position}))),M(e,"house-front",t,i,a,s,0,i/2,o/2,0),M(e,"house-back",t,i,a,s,0,i/2,-o/2,0),M(e,"house-left",o,i,a,s,-t/2,i/2,0,Math.PI/2),M(e,"house-right",o,i,a,s,t/2,i/2,0,Math.PI/2)},y=(e,i,a,s,l)=>{let d=t.find(e=>"house"===e.type);if(!d)return;let c=d.x,w=d.y,h=d.width,p=d.height;o.forEach(t=>{let o=(t.x1-c-h/2)/30*l,d=(t.y1-w-p/2)/30*l,x=(t.x2-c-h/2)/30*l,m=(t.y2-w-p/2)/30*l,f=Math.sqrt(Math.pow(x-o,2)+Math.pow(m-d,2));if(f<.1)return;let b=n.filter(e=>e.wallId===t.id);if(b.length>0)v(e,t,b,i,a,s,l);else{let t=new r.DvJ(f,i,a),n=new r.Kj0(t,s);n.position.set((o+x)/2,i/2,-(d+m)/2),n.rotation.y=-Math.atan2(m-d,x-o),n.castShadow=!0,e.add(n)}})},v=(e,o,i,n,a,s,l)=>{let d=t.find(e=>"house"===e.type);if(!d)return;let c=d.x,w=d.y,h=d.width,p=d.height,x=(o.x1-c-h/2)/30*l,m=(o.y1-w-p/2)/30*l,f=(o.x2-c-h/2)/30*l,b=(o.y2-w-p/2)/30*l,u=Math.sqrt(Math.pow(f-x,2)+Math.pow(b-m,2)),g=Math.atan2(b-m,f-x),y=(x+f)/2,v=-(m+b)/2;i.sort((e,t)=>e.position-t.position);let k=0,j=2.1*l;if(i.forEach(t=>{let o=t.realWidth*l,i=t.position*u-o/2,d=t.position*u+o/2;if(i>k){let t=i-k,o=new r.DvJ(t,n,a),l=new r.Kj0(o,s),d=k+t/2-u/2;l.position.set(y+d*Math.cos(-g),n/2,v+d*Math.sin(-g)),l.rotation.y=-g,l.castShadow=!0,e.add(l)}let c=n-j;if(c>0){let i=new r.DvJ(o,c,a),n=new r.Kj0(i,s),l=t.position*u-u/2;n.position.set(y+l*Math.cos(-g),j+c/2,v+l*Math.sin(-g)),n.rotation.y=-g,n.castShadow=!0,e.add(n)}k=d}),k<u){let t=u-k,o=new r.DvJ(t,n,a),i=new r.Kj0(o,s),l=k+t/2-u/2;i.position.set(y+l*Math.cos(-g),n/2,v+l*Math.sin(-g)),i.rotation.y=-g,i.castShadow=!0,e.add(i)}},k=(e,i,a,s)=>{let l=t.find(e=>"house"===e.type);l&&n.forEach(t=>{let i=o.find(e=>e.id===t.wallId);if(!i)return;let n=l.x,d=l.y,c=l.width,w=l.height,h=i.x1+(i.x2-i.x1)*t.position,p=i.y1+(i.y2-i.y1)*t.position,x=t.realWidth*s,m=2.1*s,f=new r.ZAu,b=new r.DvJ(x,m,.05*s),u=new r.Kj0(b,a),g=Math.abs(i.x2-i.x1)>Math.abs(i.y2-i.y1);g?(u.position.set(.25*x,m/2,-(.25*x)),u.rotation.y=Math.PI/3):(u.position.set(-(.25*x),m/2,.25*x),u.rotation.y=-Math.PI/3),f.add(u);let y=new r.xo$(.015*s,8,8),v=new r.xoR({color:12632256}),k=new r.Kj0(y,v);g?k.position.set(.4*x,.5*m,-(.15*x)):k.position.set(-(.15*x),.5*m,.4*x),f.add(k),f.position.set((h-n-c/2)/30*s,0,-(p-d-w/2)/30*s),f.children.forEach(e=>{e.castShadow=!0}),e.add(f)})},j=(e,i,n,a,s)=>{let d=t.find(e=>"house"===e.type);d&&l.forEach(t=>{let l=o.find(e=>e.id===t.wallId);if(!l)return;let c=d.x,w=d.y,h=d.width,p=d.height,x=l.x1+(l.x2-l.x1)*t.position,m=l.y1+(l.y2-l.y1)*t.position,f=t.realWidth*s,b=1.2*s,u=.1*s,g=new r.ZAu,y=new r.DvJ(f+u,b+u,u),v=new r.Kj0(y,a);g.add(v);let k=new r.DvJ(.9*f,.9*b,.02*s),j=new r.Kj0(k,n);j.position.z=u/4,g.add(j);let z=new r.DvJ(.9*f,.02*s,u/2),M=new r.Kj0(z,a);g.add(M);let S=new r.DvJ(.02*s,.9*b,u/2),D=new r.Kj0(S,a);g.add(D),g.position.set((x-c-h/2)/30*s,i/2,-(m-w-p/2)/30*s),Math.abs(l.x2-l.x1)>Math.abs(l.y2-l.y1)||(g.rotation.y=Math.PI/2),g.children.forEach(e=>{e.castShadow=!0}),e.add(g)})},z=(e,t,o,i,n)=>{let a=new r.xoR({color:6908265}),s=new r.xoR({color:3100495});new r.xoR({color:9109504});let l=new r.DvJ(t+.4*n,.5*n,o+.4*n),d=new r.Kj0(l,a);d.position.y=-.25*n,d.castShadow=!0,d.receiveShadow=!0,e.add(d);let c=new r.fHI(.05*n,.05*n,t,8),w=new r.Kj0(c,s);w.rotation.z=Math.PI/2,w.position.set(0,i-.1*n,o/2+.1*n),e.add(w);let h=new r.Kj0(c,s);h.rotation.z=Math.PI/2,h.position.set(0,i-.1*n,-o/2-.1*n),e.add(h);let p=new r.fHI(.05*n,.05*n,i-.2*n,8),x=new r.Kj0(p,s);x.position.set(t/2-.2*n,(i-.2*n)/2,o/2+.1*n),e.add(x)},M=(e,t,o,i,a,s,d,c,w,h)=>{let p=[];if(n.forEach(e=>{let i=String(e.wallId),n=String(t);if(i===n||"house-front"===n&&"house-top"===i||"house-back"===n&&"house-bottom"===i||"house-left"===n&&"house-left"===i||"house-right"===n&&"house-right"===i){console.log("Found matching door: wallId=".concat(i," matches targetWallId=").concat(n));let t=o/10;p.push({type:"door",position:e.position*t,width:10*(e.realWidth||.9),height:21,data:e})}else console.log("Door not matching: wallId=".concat(i," does not match targetWallId=").concat(n))}),l.forEach(e=>{let i=String(e.wallId),n=String(t);if(i===n||"house-front"===n&&"house-top"===i||"house-back"===n&&"house-bottom"===i||"house-left"===n&&"house-left"===i||"house-right"===n&&"house-right"===i){console.log("Found matching window: wallId=".concat(i," matches targetWallId=").concat(n));let t=o/10;p.push({type:"window",position:e.position*t,width:10*(e.realWidth||1.2),height:12,data:e})}else console.log("Window not matching: wallId=".concat(i," does not match targetWallId=").concat(n))}),0===p.length){let t=new r.DvJ(o,i,a),n=new r.Kj0(t,s);n.position.set(d,c,w),n.rotation.y=h,n.castShadow=!0,e.add(n)}else S(e,o,i,a,s,p,d,c,w,h)},S=(e,t,o,i,n,a,s,l,d,c)=>{console.log("Creating wall segments with ".concat(a.length," openings:"),a.map(e=>({type:e.type,position:e.position,width:e.width}))),a.sort((e,t)=>e.position-t.position);let w=t/10,h=0;if(a.forEach(a=>{let p=a.width/10,x=Math.max(0,a.position-p/2),m=Math.min(w,a.position+p/2);if(x>h){let a=x-h,w=10*a;if(w>.5){let p=new r.DvJ(w,o,i),x=new r.Kj0(p,n),m=10*(h+a/2),f=s+(0===c?m-t/2:0),b=d+(0!==c?m-t/2:0);x.position.set(f,l,b),x.rotation.y=c,x.castShadow=!0,e.add(x)}}if("window"===a.type){let l,w;let h=9+a.height;{let o,l;let w=new r.DvJ(a.width,9,i),h=new r.Kj0(w,n);0===c?(o=s+(10*a.position-t/2),l=d):(o=s,l=d+(10*a.position-t/2)),h.position.set(o,4.5,l),h.rotation.y=c,h.castShadow=!0,e.add(h)}if(h<o){let l,w;let p=o-h,x=new r.DvJ(a.width,p,i),m=new r.Kj0(x,n);0===c?(l=s+(10*a.position-t/2),w=d):(l=s,w=d+(10*a.position-t/2)),m.position.set(l,h+p/2,w),m.rotation.y=c,m.castShadow=!0,e.add(m)}let p=new r.DvJ(.9*a.width,.9*a.height,.3*i),x=new r.xoR({color:16777215}),m=new r.Kj0(p,x),f=new r.DvJ(.8*a.width,.8*a.height,.1*i),b=new r.xoR({color:8900331,transparent:!0,opacity:.6}),u=new r.Kj0(f,b);0===c?(l=s+(10*a.position-t/2),w=d):(l=s,w=d+(10*a.position-t/2)),m.position.set(l,9+a.height/2,w),m.rotation.y=c,m.castShadow=!0,e.add(m),u.position.set(l,9+a.height/2,w),u.rotation.y=c,e.add(u)}else if("door"===a.type){let l,w;if(21<o){let l,w;let h=o-21,p=new r.DvJ(a.width,h,i),x=new r.Kj0(p,n);0===c?(l=s+(10*a.position-t/2),w=d):(l=s,w=d+(10*a.position-t/2)),x.position.set(l,21+h/2,w),x.rotation.y=c,x.castShadow=!0,e.add(x)}let h=new r.DvJ(.9*a.width,19.95,.3*i),p=new r.xoR({color:9127187}),x=new r.Kj0(h,p),m=new r.DvJ(.8*a.width,18.900000000000002,.1*i),f=new r.xoR({color:6636321}),b=new r.Kj0(m,f);0===c?(l=s+(10*a.position-t/2),w=d):(l=s,w=d+(10*a.position-t/2)),x.position.set(l,10.5,w),x.rotation.y=c,x.castShadow=!0,e.add(x),b.position.set(l,10.5,w),b.rotation.y=c,b.castShadow=!0,e.add(b)}h=m}),h<w){let a=w-h,p=10*a;if(p>.5){let w=new r.DvJ(p,o,i),x=new r.Kj0(w,n),m=10*(h+a/2),f=s+(0===c?m-t/2:0),b=d+(0!==c?m-t/2:0);x.position.set(f,l,b),x.rotation.y=c,x.castShadow=!0,e.add(x)}}},D=e=>{let t=new r.xoR({color:9127187}),o=new r.xoR({color:2263842});[{x:-60,z:-50,scale:1.2},{x:55,z:-45,scale:.8},{x:-50,z:60,scale:1},{x:65,z:55,scale:1.1},{x:-70,z:30,scale:.9}].forEach(i=>{let n=new r.ZAu,a=new r.fHI(.5*i.scale,.8*i.scale,8*i.scale,8),s=new r.Kj0(a,t);s.position.y=4*i.scale,s.castShadow=!0,n.add(s);let l=new r.xo$(4*i.scale,8,6),d=new r.Kj0(l,o);d.position.y=10*i.scale,d.castShadow=!0,n.add(d),n.position.set(i.x,0,i.z),e.add(n)})};return(0,i.jsxs)("div",{className:"jsx-d6849395535c0685 house-3d-viewer",children:[f&&(0,i.jsxs)("div",{className:"jsx-d6849395535c0685 loading-overlay",children:[(0,i.jsx)("div",{className:"jsx-d6849395535c0685 loading-spinner"}),(0,i.jsx)("p",{className:"jsx-d6849395535c0685",children:"Загрузка 3D модели..."})]}),(0,i.jsxs)("div",{className:"jsx-d6849395535c0685 viewer-controls",children:[(0,i.jsx)("button",{onClick:c,className:"jsx-d6849395535c0685 close-btn",children:"✕ Закрыть 3D"}),(0,i.jsxs)("div",{className:"jsx-d6849395535c0685 controls-info",children:[(0,i.jsx)("span",{className:"jsx-d6849395535c0685",children:"\uD83D\uDDB1️ Перетаскивайте для поворота"}),(0,i.jsx)("span",{className:"jsx-d6849395535c0685",children:"\uD83D\uDD0D Колесо мыши для масштаба"})]})]}),(0,i.jsx)("div",{ref:w,className:"jsx-d6849395535c0685 viewer-container"}),(0,i.jsx)(a(),{id:"d6849395535c0685",children:".house-3d-viewer.jsx-d6849395535c0685{position:fixed;top:0;left:0;width:100vw;height:100vh;background:#000;z-index:1000;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.loading-overlay.jsx-d6849395535c0685{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;color:white;z-index:1001}.loading-spinner.jsx-d6849395535c0685{width:50px;height:50px;border:4px solid rgba(255,255,255,.3);border-top:4px solid#fff;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;-webkit-animation:spin 1s linear infinite;-moz-animation:spin 1s linear infinite;-o-animation:spin 1s linear infinite;animation:spin 1s linear infinite;margin-bottom:20px}@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-moz-keyframes spin{0%{-moz-transform:rotate(0deg);transform:rotate(0deg)}100%{-moz-transform:rotate(360deg);transform:rotate(360deg)}}@-o-keyframes spin{0%{-o-transform:rotate(0deg);transform:rotate(0deg)}100%{-o-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spin{0%{-webkit-transform:rotate(0deg);-moz-transform:rotate(0deg);-o-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);-moz-transform:rotate(360deg);-o-transform:rotate(360deg);transform:rotate(360deg)}}.viewer-controls.jsx-d6849395535c0685{position:absolute;top:20px;left:20px;right:20px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-moz-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;z-index:1001;pointer-events:none}.close-btn.jsx-d6849395535c0685{background:var(--accent-orange);color:white;border:none;padding:12px 20px;-webkit-border-radius:6px;-moz-border-radius:6px;border-radius:6px;cursor:pointer;font-size:16px;font-weight:500;-webkit-transition:all.3s ease;-moz-transition:all.3s ease;-o-transition:all.3s ease;transition:all.3s ease;pointer-events:auto;-webkit-box-shadow:0 4px 12px rgba(0,0,0,.3);-moz-box-shadow:0 4px 12px rgba(0,0,0,.3);box-shadow:0 4px 12px rgba(0,0,0,.3)}.close-btn.jsx-d6849395535c0685:hover{background:#c55a24;-webkit-transform:translatey(-2px);-moz-transform:translatey(-2px);-ms-transform:translatey(-2px);-o-transform:translatey(-2px);transform:translatey(-2px);-webkit-box-shadow:0 6px 16px rgba(0,0,0,.4);-moz-box-shadow:0 6px 16px rgba(0,0,0,.4);box-shadow:0 6px 16px rgba(0,0,0,.4)}.controls-info.jsx-d6849395535c0685{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;gap:8px;color:white;font-size:14px;background:rgba(0,0,0,.6);padding:12px 16px;-webkit-border-radius:6px;-moz-border-radius:6px;border-radius:6px;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.viewer-container.jsx-d6849395535c0685{-webkit-box-flex:1;-webkit-flex:1;-moz-box-flex:1;-ms-flex:1;flex:1;width:100%;height:100%}.viewer-container.jsx-d6849395535c0685 canvas.jsx-d6849395535c0685{display:block;cursor:-webkit-grab;cursor:-moz-grab;cursor:grab}.viewer-container.jsx-d6849395535c0685 canvas.jsx-d6849395535c0685:active{cursor:-webkit-grabbing;cursor:-moz-grabbing;cursor:grabbing}@media(max-width:768px){.viewer-controls.jsx-d6849395535c0685{-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;gap:12px;-webkit-box-align:stretch;-webkit-align-items:stretch;-moz-box-align:stretch;-ms-flex-align:stretch;align-items:stretch}.controls-info.jsx-d6849395535c0685{font-size:12px;text-align:center}.close-btn.jsx-d6849395535c0685{width:100%;text-align:center}}"})]})}}}]);